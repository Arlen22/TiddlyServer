{"title":"$:/plugins/tiddlywiki/qrcode","description":"QR Code generator","author":"Zeno Zeng, adapted by Jeremy Ruston","plugin-type":"plugin","list":"readme usage examples license","version":"5.1.18-prerelease","dependents":"","type":"application/json","tiddlers":{"$:/plugins/tiddlywiki/qrcode/examples":{"title":"$:/plugins/tiddlywiki/qrcode/examples","text":"<<tabs \"[all[shadows+tiddlers]tag[$:/tags/MakeQR]!has[draft.of]]\" \"$:/plugins/tiddlywiki/qrcode/MakeGenericQR\">>"},"$:/plugins/tiddlywiki/qrcode/readme":{"title":"$:/plugins/tiddlywiki/qrcode/readme","text":"The QR code plugin provides a macro that enables any text to be rendered as a [[QR code|https://en.wikipedia.org/wiki/QR_code]]. QR codes are a type of 2-dimensional bar code that encodes arbitrary data: text, numbers, links. QR code readers are available or built-in for smartphones, making them a convenient means to transfer information between devices\n\nThe QR code plugin adds the following features to TiddlyWiki:\n\n* A new [[makeqr Macro]] that renders specified text as a QR code image that can be displayed or printed\r\n* A new toolbar button that can display several QR code renderings of the content of a tiddler:\r\n** Raw content\r\n** Rendered, formatted content\r\n** URL of tiddler\n\nThe QR code plugin is based on the library [[qrcode.js by Zeno Zeng|https://github.com/zenozeng/node-yaqrcode]]."},"$:/plugins/tiddlywiki/qrcode/usage":{"title":"$:/plugins/tiddlywiki/qrcode/usage","text":"! `makeqr` Macro\n\nThe <<.def makeqr>> [[macro|Macros]] converts text data into an image of the corresponding QR code. The image is returned as [[base64-encoded data URI|https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs]].\n\n!! Parameters\n\n;text\r\n: The text to encode\r\n;size\r\n: The size of the image in pixels (defaults to 500)\r\n;errorCorrectLevel\r\n: Determines the amount of error correction applied to the image; see below (defaults to \"M\").\r\n;fallback\r\n: The fallback image to be returned in case of an error (see below)\n\nThe conversion will fail if the text is too long and/or complex and the macro will return the provided fallback image. If no fallback image is provided then an error image is generated.\n\nThe error correction level is a [[QR code feature|http://www.qrcode.com/en/about/error_correction.html]]:\n\n<<<\r\nQR Code has error correction capability to restore data if the code is dirty or damaged. ... Level Q or H may be selected for factory environment where QR Code get dirty, whereas Level L may be selected for clean environment with the large amount of data. Typically, Level M (15%) is most frequently selected.\r\n<<<\n\n!! Examples\n\nMaking a QR code for a simple string of text:\n\n```\r\n<<makeqr \"Hello there!\">>\r\n```\n\nMaking a QR code for the URL field of the current tiddler:\n\n```\r\n<$macrocall $name=\"makeqr\" text={{!!url}}/>\r\n```\n\nMaking a QR code for the URL of the current wiki:\n\n```\r\n<$macrocall $name=\"makeqr\" text={{$:/info/url/full}}/>\r\n```\r\n"},"$:/plugins/tiddlywiki/qrcode/qrcode.js":{"text":"//---------------------------------------------------------------------\r\n//\r\n// QR Code Generator for JavaScript\r\n//\r\n// Copyright (c) 2009 Kazuhiko Arase\r\n//\r\n// URL: http://www.d-project.com/\r\n//\r\n// Licensed under the MIT license:\r\n//\thttp://www.opensource.org/licenses/mit-license.php\r\n//\r\n// The word 'QR Code' is registered trademark of\r\n// DENSO WAVE INCORPORATED\r\n//\thttp://www.denso-wave.com/qrcode/faqpatent-e.html\r\n//\r\n//---------------------------------------------------------------------\r\n\r\n//---------------------------------------------------------------------\r\n// qrcode\r\n//---------------------------------------------------------------------\r\n\r\n/**\r\n * qrcode\r\n * @param typeNumber 1 to 40\r\n * @param errorCorrectLevel 'L','M','Q','H'\r\n */\r\nvar qrcode = function(typeNumber, errorCorrectLevel) {\r\n\r\n    var PAD0 = 0xEC;\r\n    var PAD1 = 0x11;\r\n\r\n    var _typeNumber = typeNumber;\r\n    var _errorCorrectLevel = QRErrorCorrectLevel[errorCorrectLevel];\r\n    var _modules = null;\r\n    var _moduleCount = 0;\r\n    var _dataCache = null;\r\n    var _dataList = new Array();\r\n\r\n    var _this = {};\r\n\r\n    var makeImpl = function(test, maskPattern) {\r\n\r\n\t_moduleCount = _typeNumber * 4 + 17;\r\n\t_modules = function(moduleCount) {\r\n\t    var modules = new Array(moduleCount);\r\n\t    for (var row = 0; row < moduleCount; row += 1) {\r\n\t\tmodules[row] = new Array(moduleCount);\r\n\t\tfor (var col = 0; col < moduleCount; col += 1) {\r\n\t\t    modules[row][col] = null;\r\n\t\t}\r\n\t    }\r\n\t    return modules;\r\n\t}(_moduleCount);\r\n\r\n\tsetupPositionProbePattern(0, 0);\r\n\tsetupPositionProbePattern(_moduleCount - 7, 0);\r\n\tsetupPositionProbePattern(0, _moduleCount - 7);\r\n\tsetupPositionAdjustPattern();\r\n\tsetupTimingPattern();\r\n\tsetupTypeInfo(test, maskPattern);\r\n\r\n\tif (_typeNumber >= 7) {\r\n\t    setupTypeNumber(test);\r\n\t}\r\n\r\n\tif (_dataCache == null) {\r\n\t    _dataCache = createData(_typeNumber, _errorCorrectLevel, _dataList);\r\n\t}\r\n\r\n\tmapData(_dataCache, maskPattern);\r\n    };\r\n\r\n    var setupPositionProbePattern = function(row, col) {\r\n\r\n\tfor (var r = -1; r <= 7; r += 1) {\r\n\r\n\t    if (row + r <= -1 || _moduleCount <= row + r) continue;\r\n\r\n\t    for (var c = -1; c <= 7; c += 1) {\r\n\r\n\t\tif (col + c <= -1 || _moduleCount <= col + c) continue;\r\n\r\n\t\tif ( (0 <= r && r <= 6 && (c == 0 || c == 6) )\r\n\t\t     || (0 <= c && c <= 6 && (r == 0 || r == 6) )\r\n\t\t     || (2 <= r && r <= 4 && 2 <= c && c <= 4) ) {\r\n\t\t    _modules[row + r][col + c] = true;\r\n\t\t} else {\r\n\t\t    _modules[row + r][col + c] = false;\r\n\t\t}\r\n\t    }\r\n\t}\r\n    };\r\n\r\n    var getBestMaskPattern = function() {\r\n\r\n\tvar minLostPoint = 0;\r\n\tvar pattern = 0;\r\n\r\n\tfor (var i = 0; i < 8; i += 1) {\r\n\r\n\t    makeImpl(true, i);\r\n\r\n\t    var lostPoint = QRUtil.getLostPoint(_this);\r\n\r\n\t    if (i == 0 || minLostPoint > lostPoint) {\r\n\t\tminLostPoint = lostPoint;\r\n\t\tpattern = i;\r\n\t    }\r\n\t}\r\n\r\n\treturn pattern;\r\n    };\r\n\r\n    var setupTimingPattern = function() {\r\n\r\n\tfor (var r = 8; r < _moduleCount - 8; r += 1) {\r\n\t    if (_modules[r][6] != null) {\r\n\t\tcontinue;\r\n\t    }\r\n\t    _modules[r][6] = (r % 2 == 0);\r\n\t}\r\n\r\n\tfor (var c = 8; c < _moduleCount - 8; c += 1) {\r\n\t    if (_modules[6][c] != null) {\r\n\t\tcontinue;\r\n\t    }\r\n\t    _modules[6][c] = (c % 2 == 0);\r\n\t}\r\n    };\r\n\r\n    var setupPositionAdjustPattern = function() {\r\n\r\n\tvar pos = QRUtil.getPatternPosition(_typeNumber);\r\n\r\n\tfor (var i = 0; i < pos.length; i += 1) {\r\n\r\n\t    for (var j = 0; j < pos.length; j += 1) {\r\n\r\n\t\tvar row = pos[i];\r\n\t\tvar col = pos[j];\r\n\r\n\t\tif (_modules[row][col] != null) {\r\n\t\t    continue;\r\n\t\t}\r\n\r\n\t\tfor (var r = -2; r <= 2; r += 1) {\r\n\r\n\t\t    for (var c = -2; c <= 2; c += 1) {\r\n\r\n\t\t\tif (r == -2 || r == 2 || c == -2 || c == 2\r\n\t\t\t    || (r == 0 && c == 0) ) {\r\n\t\t\t    _modules[row + r][col + c] = true;\r\n\t\t\t} else {\r\n\t\t\t    _modules[row + r][col + c] = false;\r\n\t\t\t}\r\n\t\t    }\r\n\t\t}\r\n\t    }\r\n\t}\r\n    };\r\n\r\n    var setupTypeNumber = function(test) {\r\n\r\n\tvar bits = QRUtil.getBCHTypeNumber(_typeNumber);\r\n\r\n\tfor (var i = 0; i < 18; i += 1) {\r\n\t    var mod = (!test && ( (bits >> i) & 1) == 1);\r\n\t    _modules[Math.floor(i / 3)][i % 3 + _moduleCount - 8 - 3] = mod;\r\n\t}\r\n\r\n\tfor (var i = 0; i < 18; i += 1) {\r\n\t    var mod = (!test && ( (bits >> i) & 1) == 1);\r\n\t    _modules[i % 3 + _moduleCount - 8 - 3][Math.floor(i / 3)] = mod;\r\n\t}\r\n    };\r\n\r\n    var setupTypeInfo = function(test, maskPattern) {\r\n\r\n\tvar data = (_errorCorrectLevel << 3) | maskPattern;\r\n\tvar bits = QRUtil.getBCHTypeInfo(data);\r\n\r\n\t// vertical\r\n\tfor (var i = 0; i < 15; i += 1) {\r\n\r\n\t    var mod = (!test && ( (bits >> i) & 1) == 1);\r\n\r\n\t    if (i < 6) {\r\n\t\t_modules[i][8] = mod;\r\n\t    } else if (i < 8) {\r\n\t\t_modules[i + 1][8] = mod;\r\n\t    } else {\r\n\t\t_modules[_moduleCount - 15 + i][8] = mod;\r\n\t    }\r\n\t}\r\n\r\n\t// horizontal\r\n\tfor (var i = 0; i < 15; i += 1) {\r\n\r\n\t    var mod = (!test && ( (bits >> i) & 1) == 1);\r\n\r\n\t    if (i < 8) {\r\n\t\t_modules[8][_moduleCount - i - 1] = mod;\r\n\t    } else if (i < 9) {\r\n\t\t_modules[8][15 - i - 1 + 1] = mod;\r\n\t    } else {\r\n\t\t_modules[8][15 - i - 1] = mod;\r\n\t    }\r\n\t}\r\n\r\n\t// fixed module\r\n\t_modules[_moduleCount - 8][8] = (!test);\r\n    };\r\n\r\n    var mapData = function(data, maskPattern) {\r\n\r\n\tvar inc = -1;\r\n\tvar row = _moduleCount - 1;\r\n\tvar bitIndex = 7;\r\n\tvar byteIndex = 0;\r\n\tvar maskFunc = QRUtil.getMaskFunction(maskPattern);\r\n\r\n\tfor (var col = _moduleCount - 1; col > 0; col -= 2) {\r\n\r\n\t    if (col == 6) col -= 1;\r\n\r\n\t    while (true) {\r\n\r\n\t\tfor (var c = 0; c < 2; c += 1) {\r\n\r\n\t\t    if (_modules[row][col - c] == null) {\r\n\r\n\t\t\tvar dark = false;\r\n\r\n\t\t\tif (byteIndex < data.length) {\r\n\t\t\t    dark = ( ( (data[byteIndex] >>> bitIndex) & 1) == 1);\r\n\t\t\t}\r\n\r\n\t\t\tvar mask = maskFunc(row, col - c);\r\n\r\n\t\t\tif (mask) {\r\n\t\t\t    dark = !dark;\r\n\t\t\t}\r\n\r\n\t\t\t_modules[row][col - c] = dark;\r\n\t\t\tbitIndex -= 1;\r\n\r\n\t\t\tif (bitIndex == -1) {\r\n\t\t\t    byteIndex += 1;\r\n\t\t\t    bitIndex = 7;\r\n\t\t\t}\r\n\t\t    }\r\n\t\t}\r\n\r\n\t\trow += inc;\r\n\r\n\t\tif (row < 0 || _moduleCount <= row) {\r\n\t\t    row -= inc;\r\n\t\t    inc = -inc;\r\n\t\t    break;\r\n\t\t}\r\n\t    }\r\n\t}\r\n    };\r\n\r\n    var createBytes = function(buffer, rsBlocks) {\r\n\r\n\tvar offset = 0;\r\n\r\n\tvar maxDcCount = 0;\r\n\tvar maxEcCount = 0;\r\n\r\n\tvar dcdata = new Array(rsBlocks.length);\r\n\tvar ecdata = new Array(rsBlocks.length);\r\n\r\n\tfor (var r = 0; r < rsBlocks.length; r += 1) {\r\n\r\n\t    var dcCount = rsBlocks[r].dataCount;\r\n\t    var ecCount = rsBlocks[r].totalCount - dcCount;\r\n\r\n\t    maxDcCount = Math.max(maxDcCount, dcCount);\r\n\t    maxEcCount = Math.max(maxEcCount, ecCount);\r\n\r\n\t    dcdata[r] = new Array(dcCount);\r\n\r\n\t    for (var i = 0; i < dcdata[r].length; i += 1) {\r\n\t\tdcdata[r][i] = 0xff & buffer.getBuffer()[i + offset];\r\n\t    }\r\n\t    offset += dcCount;\r\n\r\n\t    var rsPoly = QRUtil.getErrorCorrectPolynomial(ecCount);\r\n\t    var rawPoly = qrPolynomial(dcdata[r], rsPoly.getLength() - 1);\r\n\r\n\t    var modPoly = rawPoly.mod(rsPoly);\r\n\t    ecdata[r] = new Array(rsPoly.getLength() - 1);\r\n\t    for (var i = 0; i < ecdata[r].length; i += 1) {\r\n\t\tvar modIndex = i + modPoly.getLength() - ecdata[r].length;\r\n\t\tecdata[r][i] = (modIndex >= 0)? modPoly.getAt(modIndex) : 0;\r\n\t    }\r\n\t}\r\n\r\n\tvar totalCodeCount = 0;\r\n\tfor (var i = 0; i < rsBlocks.length; i += 1) {\r\n\t    totalCodeCount += rsBlocks[i].totalCount;\r\n\t}\r\n\r\n\tvar data = new Array(totalCodeCount);\r\n\tvar index = 0;\r\n\r\n\tfor (var i = 0; i < maxDcCount; i += 1) {\r\n\t    for (var r = 0; r < rsBlocks.length; r += 1) {\r\n\t\tif (i < dcdata[r].length) {\r\n\t\t    data[index] = dcdata[r][i];\r\n\t\t    index += 1;\r\n\t\t}\r\n\t    }\r\n\t}\r\n\r\n\tfor (var i = 0; i < maxEcCount; i += 1) {\r\n\t    for (var r = 0; r < rsBlocks.length; r += 1) {\r\n\t\tif (i < ecdata[r].length) {\r\n\t\t    data[index] = ecdata[r][i];\r\n\t\t    index += 1;\r\n\t\t}\r\n\t    }\r\n\t}\r\n\r\n\treturn data;\r\n    };\r\n\r\n    var createData = function(typeNumber, errorCorrectLevel, dataList) {\r\n\r\n\tvar rsBlocks = QRRSBlock.getRSBlocks(typeNumber, errorCorrectLevel);\r\n\r\n\tvar buffer = qrBitBuffer();\r\n\r\n\tfor (var i = 0; i < dataList.length; i += 1) {\r\n\t    var data = dataList[i];\r\n\t    buffer.put(data.getMode(), 4);\r\n\t    buffer.put(data.getLength(), QRUtil.getLengthInBits(data.getMode(), typeNumber) );\r\n\t    data.write(buffer);\r\n\t}\r\n\r\n\t// calc num max data.\r\n\tvar totalDataCount = 0;\r\n\tfor (var i = 0; i < rsBlocks.length; i += 1) {\r\n\t    totalDataCount += rsBlocks[i].dataCount;\r\n\t}\r\n\r\n\tif (buffer.getLengthInBits() > totalDataCount * 8) {\r\n\t    throw new Error('code length overflow. ('\r\n\t\t\t    + buffer.getLengthInBits()\r\n\t\t\t    + '>'\r\n\t\t\t    + totalDataCount * 8\r\n\t\t\t    + ')');\r\n\t}\r\n\r\n\t// end code\r\n\tif (buffer.getLengthInBits() + 4 <= totalDataCount * 8) {\r\n\t    buffer.put(0, 4);\r\n\t}\r\n\r\n\t// padding\r\n\twhile (buffer.getLengthInBits() % 8 != 0) {\r\n\t    buffer.putBit(false);\r\n\t}\r\n\r\n\t// padding\r\n\twhile (true) {\r\n\r\n\t    if (buffer.getLengthInBits() >= totalDataCount * 8) {\r\n\t\tbreak;\r\n\t    }\r\n\t    buffer.put(PAD0, 8);\r\n\r\n\t    if (buffer.getLengthInBits() >= totalDataCount * 8) {\r\n\t\tbreak;\r\n\t    }\r\n\t    buffer.put(PAD1, 8);\r\n\t}\r\n\r\n\treturn createBytes(buffer, rsBlocks);\r\n    };\r\n\r\n    _this.addData = function(data) {\r\n\tvar newData = qr8BitByte(data);\r\n\t_dataList.push(newData);\r\n\t_dataCache = null;\r\n    };\r\n\r\n    _this.isDark = function(row, col) {\r\n\tif (row < 0 || _moduleCount <= row || col < 0 || _moduleCount <= col) {\r\n\t    throw new Error(row + ',' + col);\r\n\t}\r\n\treturn _modules[row][col];\r\n    };\r\n\r\n    _this.getModuleCount = function() {\r\n\treturn _moduleCount;\r\n    };\r\n\r\n    _this.make = function() {\r\n\tmakeImpl(false, getBestMaskPattern() );\r\n    };\r\n\r\n    _this.createTableTag = function(cellSize, margin) {\r\n\r\n\tcellSize = cellSize || 2;\r\n\tmargin = (typeof margin == 'undefined')? cellSize * 4 : margin;\r\n\r\n\tvar qrHtml = '';\r\n\r\n\tqrHtml += '<table style=\"';\r\n\tqrHtml += ' border-width: 0px; border-style: none;';\r\n\tqrHtml += ' border-collapse: collapse;';\r\n\tqrHtml += ' padding: 0px; margin: ' + margin + 'px;';\r\n\tqrHtml += '\">';\r\n\tqrHtml += '<tbody>';\r\n\r\n\tfor (var r = 0; r < _this.getModuleCount(); r += 1) {\r\n\r\n\t    qrHtml += '<tr>';\r\n\r\n\t    for (var c = 0; c < _this.getModuleCount(); c += 1) {\r\n\t\tqrHtml += '<td style=\"';\r\n\t\tqrHtml += ' border-width: 0px; border-style: none;';\r\n\t\tqrHtml += ' border-collapse: collapse;';\r\n\t\tqrHtml += ' padding: 0px; margin: 0px;';\r\n\t\tqrHtml += ' width: ' + cellSize + 'px;';\r\n\t\tqrHtml += ' height: ' + cellSize + 'px;';\r\n\t\tqrHtml += ' background-color: ';\r\n\t\tqrHtml += _this.isDark(r, c)? '#000000' : '#ffffff';\r\n\t\tqrHtml += ';';\r\n\t\tqrHtml += '\"/>';\r\n\t    }\r\n\r\n\t    qrHtml += '</tr>';\r\n\t}\r\n\r\n\tqrHtml += '</tbody>';\r\n\tqrHtml += '</table>';\r\n\r\n\treturn qrHtml;\r\n    };\r\n\r\n    _this.createImgTag = function(cellSize, margin, size) {\r\n\r\n\tcellSize = cellSize || 2;\r\n\tmargin = (typeof margin == 'undefined')? cellSize * 4 : margin;\r\n\r\n\tvar min = margin;\r\n\tvar max = _this.getModuleCount() * cellSize + margin;\r\n\r\n\treturn createImgTag(size, size, function(x, y) {\r\n\t    if (min <= x && x < max && min <= y && y < max) {\r\n\t\tvar c = Math.floor( (x - min) / cellSize);\r\n\t\tvar r = Math.floor( (y - min) / cellSize);\r\n\t\treturn _this.isDark(r, c)? 0 : 1;\r\n\t    } else {\r\n\t\treturn 1;\r\n\t    }\r\n\t} );\r\n    };\r\n\r\n    return _this;\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// qrcode.stringToBytes\r\n//---------------------------------------------------------------------\r\n\r\nqrcode.stringToBytes = function(s) {\r\n    var bytes = new Array();\r\n    for (var i = 0; i < s.length; i += 1) {\r\n\tvar c = s.charCodeAt(i);\r\n\tbytes.push(c & 0xff);\r\n    }\r\n    return bytes;\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// qrcode.createStringToBytes\r\n//---------------------------------------------------------------------\r\n\r\n/**\r\n * @param unicodeData base64 string of byte array.\r\n * [16bit Unicode],[16bit Bytes], ...\r\n * @param numChars\r\n */\r\nqrcode.createStringToBytes = function(unicodeData, numChars) {\r\n\r\n    // create conversion map.\r\n\r\n    var unicodeMap = function() {\r\n\r\n\tvar bin = base64DecodeInputStream(unicodeData);\r\n\tvar read = function() {\r\n\t    var b = bin.read();\r\n\t    if (b == -1) throw new Error();\r\n\t    return b;\r\n\t};\r\n\r\n\tvar count = 0;\r\n\tvar unicodeMap = {};\r\n\twhile (true) {\r\n\t    var b0 = bin.read();\r\n\t    if (b0 == -1) break;\r\n\t    var b1 = read();\r\n\t    var b2 = read();\r\n\t    var b3 = read();\r\n\t    var k = String.fromCharCode( (b0 << 8) | b1);\r\n\t    var v = (b2 << 8) | b3;\r\n\t    unicodeMap[k] = v;\r\n\t    count += 1;\r\n\t}\r\n\tif (count != numChars) {\r\n\t    throw new Error(count + ' != ' + numChars);\r\n\t}\r\n\r\n\treturn unicodeMap;\r\n    }();\r\n\r\n    var unknownChar = '?'.charCodeAt(0);\r\n\r\n    return function(s) {\r\n\tvar bytes = new Array();\r\n\tfor (var i = 0; i < s.length; i += 1) {\r\n\t    var c = s.charCodeAt(i);\r\n\t    if (c < 128) {\r\n\t\tbytes.push(c);\r\n\t    } else {\r\n\t\tvar b = unicodeMap[s.charAt(i)];\r\n\t\tif (typeof b == 'number') {\r\n\t\t    if ( (b & 0xff) == b) {\r\n\t\t\t// 1byte\r\n\t\t\tbytes.push(b);\r\n\t\t    } else {\r\n\t\t\t// 2bytes\r\n\t\t\tbytes.push(b >>> 8);\r\n\t\t\tbytes.push(b & 0xff);\r\n\t\t    }\r\n\t\t} else {\r\n\t\t    bytes.push(unknownChar);\r\n\t\t}\r\n\t    }\r\n\t}\r\n\treturn bytes;\r\n    };\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// QRMode\r\n//---------------------------------------------------------------------\r\n\r\nvar QRMode = {\r\n    MODE_NUMBER :\t\t1 << 0,\r\n    MODE_ALPHA_NUM : \t1 << 1,\r\n    MODE_8BIT_BYTE : \t1 << 2,\r\n    MODE_KANJI :\t\t1 << 3\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// QRErrorCorrectLevel\r\n//---------------------------------------------------------------------\r\n\r\nvar QRErrorCorrectLevel = {\r\n    L : 1,\r\n    M : 0,\r\n    Q : 3,\r\n    H : 2\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// QRMaskPattern\r\n//---------------------------------------------------------------------\r\n\r\nvar QRMaskPattern = {\r\n    PATTERN000 : 0,\r\n    PATTERN001 : 1,\r\n    PATTERN010 : 2,\r\n    PATTERN011 : 3,\r\n    PATTERN100 : 4,\r\n    PATTERN101 : 5,\r\n    PATTERN110 : 6,\r\n    PATTERN111 : 7\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// QRUtil\r\n//---------------------------------------------------------------------\r\n\r\nvar QRUtil = function() {\r\n\r\n    var PATTERN_POSITION_TABLE = [\r\n\t[],\r\n\t[6, 18],\r\n\t[6, 22],\r\n\t[6, 26],\r\n\t[6, 30],\r\n\t[6, 34],\r\n\t[6, 22, 38],\r\n\t[6, 24, 42],\r\n\t[6, 26, 46],\r\n\t[6, 28, 50],\r\n\t[6, 30, 54],\r\n\t[6, 32, 58],\r\n\t[6, 34, 62],\r\n\t[6, 26, 46, 66],\r\n\t[6, 26, 48, 70],\r\n\t[6, 26, 50, 74],\r\n\t[6, 30, 54, 78],\r\n\t[6, 30, 56, 82],\r\n\t[6, 30, 58, 86],\r\n\t[6, 34, 62, 90],\r\n\t[6, 28, 50, 72, 94],\r\n\t[6, 26, 50, 74, 98],\r\n\t[6, 30, 54, 78, 102],\r\n\t[6, 28, 54, 80, 106],\r\n\t[6, 32, 58, 84, 110],\r\n\t[6, 30, 58, 86, 114],\r\n\t[6, 34, 62, 90, 118],\r\n\t[6, 26, 50, 74, 98, 122],\r\n\t[6, 30, 54, 78, 102, 126],\r\n\t[6, 26, 52, 78, 104, 130],\r\n\t[6, 30, 56, 82, 108, 134],\r\n\t[6, 34, 60, 86, 112, 138],\r\n\t[6, 30, 58, 86, 114, 142],\r\n\t[6, 34, 62, 90, 118, 146],\r\n\t[6, 30, 54, 78, 102, 126, 150],\r\n\t[6, 24, 50, 76, 102, 128, 154],\r\n\t[6, 28, 54, 80, 106, 132, 158],\r\n\t[6, 32, 58, 84, 110, 136, 162],\r\n\t[6, 26, 54, 82, 110, 138, 166],\r\n\t[6, 30, 58, 86, 114, 142, 170]\r\n    ];\r\n    var G15 = (1 << 10) | (1 << 8) | (1 << 5) | (1 << 4) | (1 << 2) | (1 << 1) | (1 << 0);\r\n    var G18 = (1 << 12) | (1 << 11) | (1 << 10) | (1 << 9) | (1 << 8) | (1 << 5) | (1 << 2) | (1 << 0);\r\n    var G15_MASK = (1 << 14) | (1 << 12) | (1 << 10) | (1 << 4) | (1 << 1);\r\n\r\n    var _this = {};\r\n\r\n    var getBCHDigit = function(data) {\r\n\tvar digit = 0;\r\n\twhile (data != 0) {\r\n\t    digit += 1;\r\n\t    data >>>= 1;\r\n\t}\r\n\treturn digit;\r\n    };\r\n\r\n    _this.getBCHTypeInfo = function(data) {\r\n\tvar d = data << 10;\r\n\twhile (getBCHDigit(d) - getBCHDigit(G15) >= 0) {\r\n\t    d ^= (G15 << (getBCHDigit(d) - getBCHDigit(G15) ) );\r\n\t}\r\n\treturn ( (data << 10) | d) ^ G15_MASK;\r\n    };\r\n\r\n    _this.getBCHTypeNumber = function(data) {\r\n\tvar d = data << 12;\r\n\twhile (getBCHDigit(d) - getBCHDigit(G18) >= 0) {\r\n\t    d ^= (G18 << (getBCHDigit(d) - getBCHDigit(G18) ) );\r\n\t}\r\n\treturn (data << 12) | d;\r\n    };\r\n\r\n    _this.getPatternPosition = function(typeNumber) {\r\n\treturn PATTERN_POSITION_TABLE[typeNumber - 1];\r\n    };\r\n\r\n    _this.getMaskFunction = function(maskPattern) {\r\n\r\n\tswitch (maskPattern) {\r\n\r\n\t    case QRMaskPattern.PATTERN000 :\r\n\t\treturn function(i, j) { return (i + j) % 2 == 0; };\r\n\t    case QRMaskPattern.PATTERN001 :\r\n\t\treturn function(i, j) { return i % 2 == 0; };\r\n\t    case QRMaskPattern.PATTERN010 :\r\n\t\treturn function(i, j) { return j % 3 == 0; };\r\n\t    case QRMaskPattern.PATTERN011 :\r\n\t\treturn function(i, j) { return (i + j) % 3 == 0; };\r\n\t    case QRMaskPattern.PATTERN100 :\r\n\t\treturn function(i, j) { return (Math.floor(i / 2) + Math.floor(j / 3) ) % 2 == 0; };\r\n\t    case QRMaskPattern.PATTERN101 :\r\n\t\treturn function(i, j) { return (i * j) % 2 + (i * j) % 3 == 0; };\r\n\t    case QRMaskPattern.PATTERN110 :\r\n\t\treturn function(i, j) { return ( (i * j) % 2 + (i * j) % 3) % 2 == 0; };\r\n\t    case QRMaskPattern.PATTERN111 :\r\n\t\treturn function(i, j) { return ( (i * j) % 3 + (i + j) % 2) % 2 == 0; };\r\n\r\n\t\tdefault :\r\n\t\tthrow new Error('bad maskPattern:' + maskPattern);\r\n\t}\r\n    };\r\n\r\n    _this.getErrorCorrectPolynomial = function(errorCorrectLength) {\r\n\tvar a = qrPolynomial([1], 0);\r\n\tfor (var i = 0; i < errorCorrectLength; i += 1) {\r\n\t    a = a.multiply(qrPolynomial([1, QRMath.gexp(i)], 0) );\r\n\t}\r\n\treturn a;\r\n    };\r\n\r\n    _this.getLengthInBits = function(mode, type) {\r\n\r\n\tif (1 <= type && type < 10) {\r\n\r\n\t    // 1 - 9\r\n\r\n\t    switch(mode) {\r\n\t\tcase QRMode.MODE_NUMBER \t: return 10;\r\n\t\tcase QRMode.MODE_ALPHA_NUM \t: return 9;\r\n\t\tcase QRMode.MODE_8BIT_BYTE\t: return 8;\r\n\t\tcase QRMode.MODE_KANJI\t\t: return 8;\r\n\t\t    default :\r\n\t\t    throw new Error('mode:' + mode);\r\n\t    }\r\n\r\n\t} else if (type < 27) {\r\n\r\n\t    // 10 - 26\r\n\r\n\t    switch(mode) {\r\n\t\tcase QRMode.MODE_NUMBER \t: return 12;\r\n\t\tcase QRMode.MODE_ALPHA_NUM \t: return 11;\r\n\t\tcase QRMode.MODE_8BIT_BYTE\t: return 16;\r\n\t\tcase QRMode.MODE_KANJI\t\t: return 10;\r\n\t\t    default :\r\n\t\t    throw new Error('mode:' + mode);\r\n\t    }\r\n\r\n\t} else if (type < 41) {\r\n\r\n\t    // 27 - 40\r\n\r\n\t    switch(mode) {\r\n\t\tcase QRMode.MODE_NUMBER \t: return 14;\r\n\t\tcase QRMode.MODE_ALPHA_NUM\t: return 13;\r\n\t\tcase QRMode.MODE_8BIT_BYTE\t: return 16;\r\n\t\tcase QRMode.MODE_KANJI\t\t: return 12;\r\n\t\t    default :\r\n\t\t    throw new Error('mode:' + mode);\r\n\t    }\r\n\r\n\t} else {\r\n\t    throw new Error('type:' + type);\r\n\t}\r\n    };\r\n\r\n    _this.getLostPoint = function(qrcode) {\r\n\r\n\tvar moduleCount = qrcode.getModuleCount();\r\n\r\n\tvar lostPoint = 0;\r\n\r\n\t// LEVEL1\r\n\r\n\tfor (var row = 0; row < moduleCount; row += 1) {\r\n\t    for (var col = 0; col < moduleCount; col += 1) {\r\n\r\n\t\tvar sameCount = 0;\r\n\t\tvar dark = qrcode.isDark(row, col);\r\n\r\n\t\tfor (var r = -1; r <= 1; r += 1) {\r\n\r\n\t\t    if (row + r < 0 || moduleCount <= row + r) {\r\n\t\t\tcontinue;\r\n\t\t    }\r\n\r\n\t\t    for (var c = -1; c <= 1; c += 1) {\r\n\r\n\t\t\tif (col + c < 0 || moduleCount <= col + c) {\r\n\t\t\t    continue;\r\n\t\t\t}\r\n\r\n\t\t\tif (r == 0 && c == 0) {\r\n\t\t\t    continue;\r\n\t\t\t}\r\n\r\n\t\t\tif (dark == qrcode.isDark(row + r, col + c) ) {\r\n\t\t\t    sameCount += 1;\r\n\t\t\t}\r\n\t\t    }\r\n\t\t}\r\n\r\n\t\tif (sameCount > 5) {\r\n\t\t    lostPoint += (3 + sameCount - 5);\r\n\t\t}\r\n\t    }\r\n\t};\r\n\r\n\t// LEVEL2\r\n\r\n\tfor (var row = 0; row < moduleCount - 1; row += 1) {\r\n\t    for (var col = 0; col < moduleCount - 1; col += 1) {\r\n\t\tvar count = 0;\r\n\t\tif (qrcode.isDark(row, col) ) count += 1;\r\n\t\tif (qrcode.isDark(row + 1, col) ) count += 1;\r\n\t\tif (qrcode.isDark(row, col + 1) ) count += 1;\r\n\t\tif (qrcode.isDark(row + 1, col + 1) ) count += 1;\r\n\t\tif (count == 0 || count == 4) {\r\n\t\t    lostPoint += 3;\r\n\t\t}\r\n\t    }\r\n\t}\r\n\r\n\t// LEVEL3\r\n\r\n\tfor (var row = 0; row < moduleCount; row += 1) {\r\n\t    for (var col = 0; col < moduleCount - 6; col += 1) {\r\n\t\tif (qrcode.isDark(row, col)\r\n\t\t    && !qrcode.isDark(row, col + 1)\r\n\t\t    &&  qrcode.isDark(row, col + 2)\r\n\t\t    &&  qrcode.isDark(row, col + 3)\r\n\t\t    &&  qrcode.isDark(row, col + 4)\r\n\t\t    && !qrcode.isDark(row, col + 5)\r\n\t\t    &&  qrcode.isDark(row, col + 6) ) {\r\n\t\t    lostPoint += 40;\r\n\t\t}\r\n\t    }\r\n\t}\r\n\r\n\tfor (var col = 0; col < moduleCount; col += 1) {\r\n\t    for (var row = 0; row < moduleCount - 6; row += 1) {\r\n\t\tif (qrcode.isDark(row, col)\r\n\t\t    && !qrcode.isDark(row + 1, col)\r\n\t\t    &&  qrcode.isDark(row + 2, col)\r\n\t\t    &&  qrcode.isDark(row + 3, col)\r\n\t\t    &&  qrcode.isDark(row + 4, col)\r\n\t\t    && !qrcode.isDark(row + 5, col)\r\n\t\t    &&  qrcode.isDark(row + 6, col) ) {\r\n\t\t    lostPoint += 40;\r\n\t\t}\r\n\t    }\r\n\t}\r\n\r\n\t// LEVEL4\r\n\r\n\tvar darkCount = 0;\r\n\r\n\tfor (var col = 0; col < moduleCount; col += 1) {\r\n\t    for (var row = 0; row < moduleCount; row += 1) {\r\n\t\tif (qrcode.isDark(row, col) ) {\r\n\t\t    darkCount += 1;\r\n\t\t}\r\n\t    }\r\n\t}\r\n\r\n\tvar ratio = Math.abs(100 * darkCount / moduleCount / moduleCount - 50) / 5;\r\n\tlostPoint += ratio * 10;\r\n\r\n\treturn lostPoint;\r\n    };\r\n\r\n    return _this;\r\n}();\r\n\r\n//---------------------------------------------------------------------\r\n// QRMath\r\n//---------------------------------------------------------------------\r\n\r\nvar QRMath = function() {\r\n\r\n    var EXP_TABLE = new Array(256);\r\n    var LOG_TABLE = new Array(256);\r\n\r\n    // initialize tables\r\n    for (var i = 0; i < 8; i += 1) {\r\n\tEXP_TABLE[i] = 1 << i;\r\n    }\r\n    for (var i = 8; i < 256; i += 1) {\r\n\tEXP_TABLE[i] = EXP_TABLE[i - 4]\r\n\t    ^ EXP_TABLE[i - 5]\r\n\t    ^ EXP_TABLE[i - 6]\r\n\t    ^ EXP_TABLE[i - 8];\r\n    }\r\n    for (var i = 0; i < 255; i += 1) {\r\n\tLOG_TABLE[EXP_TABLE[i] ] = i;\r\n    }\r\n\r\n    var _this = {};\r\n\r\n    _this.glog = function(n) {\r\n\r\n\tif (n < 1) {\r\n\t    throw new Error('glog(' + n + ')');\r\n\t}\r\n\r\n\treturn LOG_TABLE[n];\r\n    };\r\n\r\n    _this.gexp = function(n) {\r\n\r\n\twhile (n < 0) {\r\n\t    n += 255;\r\n\t}\r\n\r\n\twhile (n >= 256) {\r\n\t    n -= 255;\r\n\t}\r\n\r\n\treturn EXP_TABLE[n];\r\n    };\r\n\r\n    return _this;\r\n}();\r\n\r\n//---------------------------------------------------------------------\r\n// qrPolynomial\r\n//---------------------------------------------------------------------\r\n\r\nfunction qrPolynomial(num, shift) {\r\n\r\n    if (typeof num.length == 'undefined') {\r\n\tthrow new Error(num.length + '/' + shift);\r\n    }\r\n\r\n    var _num = function() {\r\n\tvar offset = 0;\r\n\twhile (offset < num.length && num[offset] == 0) {\r\n\t    offset += 1;\r\n\t}\r\n\tvar _num = new Array(num.length - offset + shift);\r\n\tfor (var i = 0; i < num.length - offset; i += 1) {\r\n\t    _num[i] = num[i + offset];\r\n\t}\r\n\treturn _num;\r\n    }();\r\n\r\n    var _this = {};\r\n\r\n    _this.getAt = function(index) {\r\n\treturn _num[index];\r\n    };\r\n\r\n    _this.getLength = function() {\r\n\treturn _num.length;\r\n    };\r\n\r\n    _this.multiply = function(e) {\r\n\r\n\tvar num = new Array(_this.getLength() + e.getLength() - 1);\r\n\r\n\tfor (var i = 0; i < _this.getLength(); i += 1) {\r\n\t    for (var j = 0; j < e.getLength(); j += 1) {\r\n\t\tnum[i + j] ^= QRMath.gexp(QRMath.glog(_this.getAt(i) ) + QRMath.glog(e.getAt(j) ) );\r\n\t    }\r\n\t}\r\n\r\n\treturn qrPolynomial(num, 0);\r\n    };\r\n\r\n    _this.mod = function(e) {\r\n\r\n\tif (_this.getLength() - e.getLength() < 0) {\r\n\t    return _this;\r\n\t}\r\n\r\n\tvar ratio = QRMath.glog(_this.getAt(0) ) - QRMath.glog(e.getAt(0) );\r\n\r\n\tvar num = new Array(_this.getLength() );\r\n\tfor (var i = 0; i < _this.getLength(); i += 1) {\r\n\t    num[i] = _this.getAt(i);\r\n\t}\r\n\r\n\tfor (var i = 0; i < e.getLength(); i += 1) {\r\n\t    num[i] ^= QRMath.gexp(QRMath.glog(e.getAt(i) ) + ratio);\r\n\t}\r\n\r\n\t// recursive call\r\n\treturn qrPolynomial(num, 0).mod(e);\r\n    };\r\n\r\n    return _this;\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// QRRSBlock\r\n//---------------------------------------------------------------------\r\n\r\nvar QRRSBlock = function() {\r\n\r\n\r\n    // [1: [L, M, Q, H], ..]\r\n    var RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];\r\n\r\n    var qrRSBlock = function(totalCount, dataCount) {\r\n\tvar _this = {};\r\n\t_this.totalCount = totalCount;\r\n\t_this.dataCount = dataCount;\r\n\treturn _this;\r\n    };\r\n\r\n    var _this = {};\r\n\r\n    var getRsBlockTable = function(typeNumber, errorCorrectLevel) {\r\n\r\n\tswitch(errorCorrectLevel) {\r\n\t    case QRErrorCorrectLevel.L :\r\n\t\treturn RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 0];\r\n\t    case QRErrorCorrectLevel.M :\r\n\t\treturn RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 1];\r\n\t    case QRErrorCorrectLevel.Q :\r\n\t\treturn RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 2];\r\n\t    case QRErrorCorrectLevel.H :\r\n\t\treturn RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 3];\r\n\t\tdefault :\r\n\t\treturn undefined;\r\n\t}\r\n    };\r\n\r\n    _this.getRSBlocks = function(typeNumber, errorCorrectLevel) {\r\n\r\n\tvar rsBlock = getRsBlockTable(typeNumber, errorCorrectLevel);\r\n\r\n\tif (typeof rsBlock == 'undefined') {\r\n\t    throw new Error('bad rs block @ typeNumber:' + typeNumber +\r\n\t\t\t    '/errorCorrectLevel:' + errorCorrectLevel);\r\n\t}\r\n\r\n\tvar length = rsBlock.length / 3;\r\n\r\n\tvar list = new Array();\r\n\r\n\tfor (var i = 0; i < length; i += 1) {\r\n\r\n\t    var count = rsBlock[i * 3 + 0];\r\n\t    var totalCount = rsBlock[i * 3 + 1];\r\n\t    var dataCount = rsBlock[i * 3 + 2];\r\n\r\n\t    for (var j = 0; j < count; j += 1) {\r\n\t\tlist.push(qrRSBlock(totalCount, dataCount) );\r\n\t    }\r\n\t}\r\n\r\n\treturn list;\r\n    };\r\n\r\n    return _this;\r\n}();\r\n\r\n//---------------------------------------------------------------------\r\n// qrBitBuffer\r\n//---------------------------------------------------------------------\r\n\r\nvar qrBitBuffer = function() {\r\n\r\n    var _buffer = new Array();\r\n    var _length = 0;\r\n\r\n    var _this = {};\r\n\r\n    _this.getBuffer = function() {\r\n\treturn _buffer;\r\n    };\r\n\r\n    _this.getAt = function(index) {\r\n\tvar bufIndex = Math.floor(index / 8);\r\n\treturn ( (_buffer[bufIndex] >>> (7 - index % 8) ) & 1) == 1;\r\n    };\r\n\r\n    _this.put = function(num, length) {\r\n\tfor (var i = 0; i < length; i += 1) {\r\n\t    _this.putBit( ( (num >>> (length - i - 1) ) & 1) == 1);\r\n\t}\r\n    };\r\n\r\n    _this.getLengthInBits = function() {\r\n\treturn _length;\r\n    };\r\n\r\n    _this.putBit = function(bit) {\r\n\r\n\tvar bufIndex = Math.floor(_length / 8);\r\n\tif (_buffer.length <= bufIndex) {\r\n\t    _buffer.push(0);\r\n\t}\r\n\r\n\tif (bit) {\r\n\t    _buffer[bufIndex] |= (0x80 >>> (_length % 8) );\r\n\t}\r\n\r\n\t_length += 1;\r\n    };\r\n\r\n    return _this;\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// qr8BitByte\r\n//---------------------------------------------------------------------\r\n\r\nvar qr8BitByte = function(data) {\r\n\r\n    var _mode = QRMode.MODE_8BIT_BYTE;\r\n    var _data = data;\r\n    var _parsedData = [];\r\n\r\n    var _this = {};\r\n\r\n\r\n    // Added to support UTF-8 Characters\r\n    for (var i = 0, l = _data.length; i < l; i++) {\r\n\tvar byteArray = [];\r\n\tvar code = _data.charCodeAt(i);\r\n\r\n\tif (code > 0x10000) {\r\n\t    byteArray[0] = 0xF0 | ((code & 0x1C0000) >>> 18);\r\n\t    byteArray[1] = 0x80 | ((code & 0x3F000) >>> 12);\r\n\t    byteArray[2] = 0x80 | ((code & 0xFC0) >>> 6);\r\n\t    byteArray[3] = 0x80 | (code & 0x3F);\r\n\t} else if (code > 0x800) {\r\n\t    byteArray[0] = 0xE0 | ((code & 0xF000) >>> 12);\r\n\t    byteArray[1] = 0x80 | ((code & 0xFC0) >>> 6);\r\n\t    byteArray[2] = 0x80 | (code & 0x3F);\r\n\t} else if (code > 0x80) {\r\n\t    byteArray[0] = 0xC0 | ((code & 0x7C0) >>> 6);\r\n\t    byteArray[1] = 0x80 | (code & 0x3F);\r\n\t} else {\r\n\t    byteArray[0] = code;\r\n\t}\r\n\r\n        // Fix Unicode corruption bug\r\n        _parsedData.push(byteArray);\r\n    }\r\n\r\n    _parsedData = Array.prototype.concat.apply([], _parsedData);\r\n\r\n    if (_parsedData.length != _data.length) {\r\n\t_parsedData.unshift(191);\r\n\t_parsedData.unshift(187);\r\n\t_parsedData.unshift(239);\r\n    }\r\n\r\n    var _bytes = _parsedData;\r\n\r\n    _this.getMode = function() {\r\n\treturn _mode;\r\n    };\r\n\r\n    _this.getLength = function(buffer) {\r\n\treturn _bytes.length;\r\n    };\r\n\r\n    _this.write = function(buffer) {\r\n\tfor (var i = 0; i < _bytes.length; i += 1) {\r\n\t    buffer.put(_bytes[i], 8);\r\n\t}\r\n    };\r\n\r\n    return _this;\r\n};\r\n\r\n//=====================================================================\r\n// GIF Support etc.\r\n//\r\n\r\n//---------------------------------------------------------------------\r\n// byteArrayOutputStream\r\n//---------------------------------------------------------------------\r\n\r\nvar byteArrayOutputStream = function() {\r\n\r\n    var _bytes = new Array();\r\n\r\n    var _this = {};\r\n\r\n    _this.writeByte = function(b) {\r\n\t_bytes.push(b & 0xff);\r\n    };\r\n\r\n    _this.writeShort = function(i) {\r\n\t_this.writeByte(i);\r\n\t_this.writeByte(i >>> 8);\r\n    };\r\n\r\n    _this.writeBytes = function(b, off, len) {\r\n\toff = off || 0;\r\n\tlen = len || b.length;\r\n\tfor (var i = 0; i < len; i += 1) {\r\n\t    _this.writeByte(b[i + off]);\r\n\t}\r\n    };\r\n\r\n    _this.writeString = function(s) {\r\n\tfor (var i = 0; i < s.length; i += 1) {\r\n\t    _this.writeByte(s.charCodeAt(i) );\r\n\t}\r\n    };\r\n\r\n    _this.toByteArray = function() {\r\n\treturn _bytes;\r\n    };\r\n\r\n    _this.toString = function() {\r\n\tvar s = '';\r\n\ts += '[';\r\n\tfor (var i = 0; i < _bytes.length; i += 1) {\r\n\t    if (i > 0) {\r\n\t\ts += ',';\r\n\t    }\r\n\t    s += _bytes[i];\r\n\t}\r\n\ts += ']';\r\n\treturn s;\r\n    };\r\n\r\n    return _this;\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// base64EncodeOutputStream\r\n//---------------------------------------------------------------------\r\n\r\nvar base64EncodeOutputStream = function() {\r\n\r\n    var _buffer = 0;\r\n    var _buflen = 0;\r\n    var _length = 0;\r\n    var _base64 = '';\r\n\r\n    var _this = {};\r\n\r\n    var writeEncoded = function(b) {\r\n\t_base64 += String.fromCharCode(encode(b & 0x3f) );\r\n    };\r\n\r\n    var encode = function(n) {\r\n\tif (n < 0) {\r\n\t    // error.\r\n\t} else if (n < 26) {\r\n\t    return 0x41 + n;\r\n\t} else if (n < 52) {\r\n\t    return 0x61 + (n - 26);\r\n\t} else if (n < 62) {\r\n\t    return 0x30 + (n - 52);\r\n\t} else if (n == 62) {\r\n\t    return 0x2b;\r\n\t} else if (n == 63) {\r\n\t    return 0x2f;\r\n\t}\r\n\tthrow new Error('n:' + n);\r\n    };\r\n\r\n    _this.writeByte = function(n) {\r\n\r\n\t_buffer = (_buffer << 8) | (n & 0xff);\r\n\t_buflen += 8;\r\n\t_length += 1;\r\n\r\n\twhile (_buflen >= 6) {\r\n\t    writeEncoded(_buffer >>> (_buflen - 6) );\r\n\t    _buflen -= 6;\r\n\t}\r\n    };\r\n\r\n    _this.flush = function() {\r\n\r\n\tif (_buflen > 0) {\r\n\t    writeEncoded(_buffer << (6 - _buflen) );\r\n\t    _buffer = 0;\r\n\t    _buflen = 0;\r\n\t}\r\n\r\n\tif (_length % 3 != 0) {\r\n\t    // padding\r\n\t    var padlen = 3 - _length % 3;\r\n\t    for (var i = 0; i < padlen; i += 1) {\r\n\t\t_base64 += '=';\r\n\t    }\r\n\t}\r\n    };\r\n\r\n    _this.toString = function() {\r\n\treturn _base64;\r\n    };\r\n\r\n    return _this;\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// base64DecodeInputStream\r\n//---------------------------------------------------------------------\r\n\r\nvar base64DecodeInputStream = function(str) {\r\n\r\n    var _str = str;\r\n    var _pos = 0;\r\n    var _buffer = 0;\r\n    var _buflen = 0;\r\n\r\n    var _this = {};\r\n\r\n    _this.read = function() {\r\n\r\n\twhile (_buflen < 8) {\r\n\r\n\t    if (_pos >= _str.length) {\r\n\t\tif (_buflen == 0) {\r\n\t\t    return -1;\r\n\t\t}\r\n\t\tthrow new Error('unexpected end of file./' + _buflen);\r\n\t    }\r\n\r\n\t    var c = _str.charAt(_pos);\r\n\t    _pos += 1;\r\n\r\n\t    if (c == '=') {\r\n\t\t_buflen = 0;\r\n\t\treturn -1;\r\n\t    } else if (c.match(/^\\s$/) ) {\r\n\t\t// ignore if whitespace.\r\n\t\tcontinue;\r\n\t    }\r\n\r\n\t    _buffer = (_buffer << 6) | decode(c.charCodeAt(0) );\r\n\t    _buflen += 6;\r\n\t}\r\n\r\n\tvar n = (_buffer >>> (_buflen - 8) ) & 0xff;\r\n\t_buflen -= 8;\r\n\treturn n;\r\n    };\r\n\r\n    var decode = function(c) {\r\n\tif (0x41 <= c && c <= 0x5a) {\r\n\t    return c - 0x41;\r\n\t} else if (0x61 <= c && c <= 0x7a) {\r\n\t    return c - 0x61 + 26;\r\n\t} else if (0x30 <= c && c <= 0x39) {\r\n\t    return c - 0x30 + 52;\r\n\t} else if (c == 0x2b) {\r\n\t    return 62;\r\n\t} else if (c == 0x2f) {\r\n\t    return 63;\r\n\t} else {\r\n\t    throw new Error('c:' + c);\r\n\t}\r\n    };\r\n\r\n    return _this;\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// gifImage (B/W)\r\n//---------------------------------------------------------------------\r\n\r\nvar gifImage = function(width, height) {\r\n\r\n    var _width = width;\r\n    var _height = height;\r\n    var _data = new Array(width * height);\r\n\r\n    var _this = {};\r\n\r\n    _this.setPixel = function(x, y, pixel) {\r\n\t_data[y * _width + x] = pixel;\r\n    };\r\n\r\n    _this.write = function(out) {\r\n\r\n\t//---------------------------------\r\n\t// GIF Signature\r\n\r\n\tout.writeString('GIF87a');\r\n\r\n\t//---------------------------------\r\n\t// Screen Descriptor\r\n\r\n\tout.writeShort(_width);\r\n\tout.writeShort(_height);\r\n\r\n\tout.writeByte(0x80); // 2bit\r\n\tout.writeByte(0);\r\n\tout.writeByte(0);\r\n\r\n\t//---------------------------------\r\n\t// Global Color Map\r\n\r\n\t// black\r\n\tout.writeByte(0x00);\r\n\tout.writeByte(0x00);\r\n\tout.writeByte(0x00);\r\n\r\n\t// white\r\n\tout.writeByte(0xff);\r\n\tout.writeByte(0xff);\r\n\tout.writeByte(0xff);\r\n\r\n\t//---------------------------------\r\n\t// Image Descriptor\r\n\r\n\tout.writeString(',');\r\n\tout.writeShort(0);\r\n\tout.writeShort(0);\r\n\tout.writeShort(_width);\r\n\tout.writeShort(_height);\r\n\tout.writeByte(0);\r\n\r\n\t//---------------------------------\r\n\t// Local Color Map\r\n\r\n\t//---------------------------------\r\n\t// Raster Data\r\n\r\n\tvar lzwMinCodeSize = 2;\r\n\tvar raster = getLZWRaster(lzwMinCodeSize);\r\n\r\n\tout.writeByte(lzwMinCodeSize);\r\n\r\n\tvar offset = 0;\r\n\r\n\twhile (raster.length - offset > 255) {\r\n\t    out.writeByte(255);\r\n\t    out.writeBytes(raster, offset, 255);\r\n\t    offset += 255;\r\n\t}\r\n\r\n\tout.writeByte(raster.length - offset);\r\n\tout.writeBytes(raster, offset, raster.length - offset);\r\n\tout.writeByte(0x00);\r\n\r\n\t//---------------------------------\r\n\t// GIF Terminator\r\n\tout.writeString(';');\r\n    };\r\n\r\n    var bitOutputStream = function(out) {\r\n\r\n\tvar _out = out;\r\n\tvar _bitLength = 0;\r\n\tvar _bitBuffer = 0;\r\n\r\n\tvar _this = {};\r\n\r\n\t_this.write = function(data, length) {\r\n\r\n\t    if ( (data >>> length) != 0) {\r\n\t\tthrow new Error('length over');\r\n\t    }\r\n\r\n\t    while (_bitLength + length >= 8) {\r\n\t\t_out.writeByte(0xff & ( (data << _bitLength) | _bitBuffer) );\r\n\t\tlength -= (8 - _bitLength);\r\n\t\tdata >>>= (8 - _bitLength);\r\n\t\t_bitBuffer = 0;\r\n\t\t_bitLength = 0;\r\n\t    }\r\n\r\n\t    _bitBuffer = (data << _bitLength) | _bitBuffer;\r\n\t    _bitLength = _bitLength + length;\r\n\t};\r\n\r\n\t_this.flush = function() {\r\n\t    if (_bitLength > 0) {\r\n\t\t_out.writeByte(_bitBuffer);\r\n\t    }\r\n\t};\r\n\r\n\treturn _this;\r\n    };\r\n\r\n    var getLZWRaster = function(lzwMinCodeSize) {\r\n\r\n\tvar clearCode = 1 << lzwMinCodeSize;\r\n\tvar endCode = (1 << lzwMinCodeSize) + 1;\r\n\tvar bitLength = lzwMinCodeSize + 1;\r\n\r\n\t// Setup LZWTable\r\n\tvar table = lzwTable();\r\n\r\n\tfor (var i = 0; i < clearCode; i += 1) {\r\n\t    table.add(String.fromCharCode(i) );\r\n\t}\r\n\ttable.add(String.fromCharCode(clearCode) );\r\n\ttable.add(String.fromCharCode(endCode) );\r\n\r\n\tvar byteOut = byteArrayOutputStream();\r\n\tvar bitOut = bitOutputStream(byteOut);\r\n\r\n\t// clear code\r\n\tbitOut.write(clearCode, bitLength);\r\n\r\n\tvar dataIndex = 0;\r\n\r\n\tvar s = String.fromCharCode(_data[dataIndex]);\r\n\tdataIndex += 1;\r\n\r\n\twhile (dataIndex < _data.length) {\r\n\r\n\t    var c = String.fromCharCode(_data[dataIndex]);\r\n\t    dataIndex += 1;\r\n\r\n\t    if (table.contains(s + c) ) {\r\n\r\n\t\ts = s + c;\r\n\r\n\t    } else {\r\n\r\n\t\tbitOut.write(table.indexOf(s), bitLength);\r\n\r\n\t\tif (table.size() < 0xfff) {\r\n\r\n\t\t    if (table.size() == (1 << bitLength) ) {\r\n\t\t\tbitLength += 1;\r\n\t\t    }\r\n\r\n\t\t    table.add(s + c);\r\n\t\t}\r\n\r\n\t\ts = c;\r\n\t    }\r\n\t}\r\n\r\n\tbitOut.write(table.indexOf(s), bitLength);\r\n\r\n\t// end code\r\n\tbitOut.write(endCode, bitLength);\r\n\r\n\tbitOut.flush();\r\n\r\n\treturn byteOut.toByteArray();\r\n    };\r\n\r\n    var lzwTable = function() {\r\n\r\n\tvar _map = {};\r\n\tvar _size = 0;\r\n\r\n\tvar _this = {};\r\n\r\n\t_this.add = function(key) {\r\n\t    if (_this.contains(key) ) {\r\n\t\tthrow new Error('dup key:' + key);\r\n\t    }\r\n\t    _map[key] = _size;\r\n\t    _size += 1;\r\n\t};\r\n\r\n\t_this.size = function() {\r\n\t    return _size;\r\n\t};\r\n\r\n\t_this.indexOf = function(key) {\r\n\t    return _map[key];\r\n\t};\r\n\r\n\t_this.contains = function(key) {\r\n\t    return typeof _map[key] != 'undefined';\r\n\t};\r\n\r\n\treturn _this;\r\n    };\r\n\r\n    return _this;\r\n};\r\n\r\nvar createImgTag = function(width, height, getPixel, alt) {\r\n\r\n    var gif = gifImage(width, height);\r\n    for (var y = 0; y < height; y += 1) {\r\n\tfor (var x = 0; x < width; x += 1) {\r\n\t    gif.setPixel(x, y, getPixel(x, y) );\r\n\t}\r\n    }\r\n\r\n    var b = byteArrayOutputStream();\r\n    gif.write(b);\r\n\r\n    var base64 = base64EncodeOutputStream();\r\n    var bytes = b.toByteArray();\r\n    for (var i = 0; i < bytes.length; i += 1) {\r\n\tbase64.writeByte(bytes[i]);\r\n    }\r\n    base64.flush();\r\n\r\n    var img = '';\r\n    img += 'data:image/gif;base64,';\r\n    img += base64;\r\n\r\n    return img;\r\n};\r\n\r\n//---------------------------------------------------------------------\r\n// returns qrcode function.\r\n\r\nmodule.exports = qrcode;\r\n","type":"application/javascript","title":"$:/plugins/tiddlywiki/qrcode/qrcode.js","module-type":"library"},"$:/plugins/tiddlywiki/qrcode/license":{"text":"The MIT License (MIT)\r\n\r\nCopyright (c) 2013 Zeno Zeng\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of\r\nthis software and associated documentation files (the \"Software\"), to deal in\r\nthe Software without restriction, including without limitation the rights to\r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\r\nthe Software, and to permit persons to whom the Software is furnished to do so,\r\nsubject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\r\nFOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\r\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\r\nIN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\r\nCONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n","type":"text/plain","title":"$:/plugins/tiddlywiki/qrcode/license"},"$:/plugins/tiddlywiki/qrcode/icon":{"title":"$:/plugins/tiddlywiki/qrcode/icon","tags":"$:/tags/Image","text":"<svg class=\"tc-image-qrcode tc-image-button\" viewBox=\"0 0 128 128\" width=\"22pt\" height=\"22pt\">\r\n    <g fill-rule=\"evenodd\">\r\n        <path d=\"M0,15.9969199 C0,7.16206498 7.16987059,0 15.9969199,0 L64.0030801,0 C72.837935,0 80,7.16987059 80,15.9969199 L80,64.0030801 C80,72.837935 72.8301294,80 64.0030801,80 L15.9969199,80 C7.16206498,80 0,72.8301294 0,64.0030801 L0,15.9969199 Z M16,22.0063866 C16,18.6891509 18.6835413,16 22.0063866,16 L57.9936134,16 C61.3108491,16 64,18.6835413 64,22.0063866 L64,57.9936134 C64,61.3108491 61.3164587,64 57.9936134,64 L22.0063866,64 C18.6891509,64 16,61.3164587 16,57.9936134 L16,22.0063866 Z M28,31.990053 C28,29.7864076 29.7842933,28 31.990053,28 L48.009947,28 C50.2135924,28 52,29.7842933 52,31.990053 L52,48.009947 C52,50.2135924 50.2157067,52 48.009947,52 L31.990053,52 C29.7864076,52 28,50.2157067 28,48.009947 L28,31.990053 Z\"></path>\r\n        <path d=\"M112,16 L112,8.49833453 L112,6.00333095 C112,2.68778282 114.67804,0 118.003331,0 L121.996669,0 C125.312217,0 128,2.67804027 128,6.00333095 L128,8.49833453 L128,23.0016655 L128,25.9966691 C128,29.3122172 125.32196,32 121.996669,32 L119.001665,32 L104.998335,32 L102.003331,32 C98.6877828,32 96,29.3219597 96,25.9966691 L96,22.0033309 C96,18.6877828 98.6780403,16 102.003331,16 L104.998335,16 L112,16 Z\"></path>\r\n        <path d=\"M96,56.9983345 L96,54.0033309 C96,50.6877828 98.6780403,48 102.003331,48 L104.998335,48 L119.001665,48 L121.996669,48 C125.312217,48 128,50.6780403 128,54.0033309 L128,57.9966691 C128,61.3122172 125.32196,64 121.996669,64 L119.001665,64 L112,64 L112,71.0016655 L112,73.9966691 C112,77.3122172 109.32196,80 105.996669,80 L102.003331,80 C98.6877828,80 96,77.3219597 96,73.9966691 L96,71.0016655 L96,56.9983345 Z\"></path>\r\n        <path d=\"M16,112 L23.0016655,112 L24.9983345,112 L32,112 L32,104.998335 L32,102.003331 C32,98.6877828 34.6780403,96 38.0033309,96 L40.9983345,96 L55.0016655,96 L57.9966691,96 C61.3122172,96 64,98.6780403 64,102.003331 L64,105.996669 C64,109.312217 61.3219597,112 57.9966691,112 L55.0016655,112 L48,112 L48,119.001665 L48,121.996669 C48,125.312217 45.3219597,128 41.9966691,128 L39.0016655,128 L24.9983345,128 L23.0016655,128 L8.99833453,128 L6.00333095,128 C2.68778282,128 0,125.32196 0,121.996669 L0,119.001665 L0,104.998335 L0,102.003331 C0,98.6877828 2.67804027,96 6.00333095,96 L9.99666905,96 C13.3122172,96 16,98.6780403 16,102.003331 L16,104.998335 L16,112 Z\"></path>\r\n        <path d=\"M103.001665,96 L105.996669,96 C109.312217,96 112,98.6780403 112,102.003331 L112,105.996669 C112,109.312217 109.32196,112 105.996669,112 L103.001665,112 L88.9983345,112 L86.0033309,112 C82.6877828,112 80,109.32196 80,105.996669 L80,102.003331 C80,98.6877828 82.6780403,96 86.0033309,96 L88.9983345,96 L103.001665,96 Z\"></path>\r\n        <path d=\"M72.9983345,112 L70.0033309,112 C66.6780403,112 64,114.687783 64,118.003331 L64,121.996669 C64,125.32196 66.6877828,128 70.0033309,128 L72.9983345,128 L87.0016655,128 L89.9966691,128 C93.3219597,128 96,125.312217 96,121.996669 L96,118.003331 C96,114.67804 93.3122172,112 89.9966691,112 L87.0016655,112 L72.9983345,112 Z\"></path>\r\n        <rect x=\"112\" y=\"80\" width=\"16\" height=\"16\" rx=\"6\"></rect>\r\n        <rect x=\"112\" y=\"112\" width=\"16\" height=\"16\" rx=\"6\"></rect>\r\n    </g>\r\n</svg>"},"$:/plugins/tiddlywiki/qrcode/MakeContactQR":{"title":"$:/plugins/tiddlywiki/qrcode/MakeContactQR","tags":"$:/tags/MakeQR","caption":"Contact","text":"\\define wifi-url()\r\nWIFI:wifi name;T:WPA;S:SSID;P:password;\r\n\\end\n\n\\define image(firstname,lastname,address,tel,email)\r\n<img src=<<makeqr text:\"\"\"MECARD:N:$lastname$,$firstname$;ADR:$address$;TEL:$tel$;EMAIL:$email$;;\"\"\" size:\"350\">>/>\r\n\\end\n\n! Enter the contact details\n\nFirst name: <$edit-text tiddler=\"$:/config/plugins/tiddlywiki/qrcode/contact/firstname\" tag=\"input\" default=\"\"/>\n\nLast name: <$edit-text tiddler=\"$:/config/plugins/tiddlywiki/qrcode/contact/lastname\" tag=\"input\" default=\"\"/>\n\nAddress: <$edit-text tiddler=\"$:/config/plugins/tiddlywiki/qrcode/contact/address\" tag=\"input\" default=\"\"/>\n\nTelephone: <$edit-text tiddler=\"$:/config/plugins/tiddlywiki/qrcode/contact/tel\" tag=\"input\" default=\"\"/>\n\nEmail: <$edit-text tiddler=\"$:/config/plugins/tiddlywiki/qrcode/contact/email\" tag=\"input\" default=\"\"/>\n\n! Here is your QR code\n\n<$macrocall $name=\"image\" firstname={{$:/config/plugins/tiddlywiki/qrcode/contact/firstname}} lastname={{$:/config/plugins/tiddlywiki/qrcode/contact/lastname}} address={{$:/config/plugins/tiddlywiki/qrcode/contact/address}} tel={{$:/config/plugins/tiddlywiki/qrcode/contact/tel}} email={{$:/config/plugins/tiddlywiki/qrcode/contact/email}}/>\r\n"},"$:/plugins/tiddlywiki/qrcode/MakeGenericQR":{"title":"$:/plugins/tiddlywiki/qrcode/MakeGenericQR","tags":"$:/tags/MakeQR","caption":"Generic","text":"\\define image(content)\r\n<img src=<<makeqr text:\"\"\"$content$\"\"\" size:\"350\">>/>\r\n\\end\n\n! Enter the details\n\nYou can also use this form to encode URLs.\n\n<$edit-text tiddler=\"$:/config/plugins/tiddlywiki/qrcode/generic\" default=\"\" class=\"tc-edit-texteditor\"/>\n\n! Here is your QR code\n\n<$macrocall $name=\"image\" content={{$:/config/plugins/tiddlywiki/qrcode/generic}}/>\r\n"},"$:/plugins/tiddlywiki/qrcode/makeqr.js":{"title":"$:/plugins/tiddlywiki/qrcode/makeqr.js","text":"/*\\\r\ntitle: $:/plugins/tiddlywiki/qrcode/makeqr.js\r\ntype: application/javascript\r\nmodule-type: macro\r\n\r\nMacro to convert a string into a QR Code\r\n\r\n\\*/\r\n(function(){\r\n\r\n/*jslint node: true, browser: true */\r\n/*global $tw: false */\r\n\"use strict\";\r\n\r\n/*\r\nInformation about this macro\r\n*/\r\n\r\nvar qrcode = require(\"$:/plugins/tiddlywiki/qrcode/qrcode.js\");\r\n\r\nvar QRCODE_GENERATION_ERROR_PREFIX = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 300 300\"><text x=\"0\" y=\"30\" fill=\"red\" font-family=\"Helvetica, sans-serif\" font-size=\"18\">',\r\n\tQRCODE_GENERATION_ERROR_SUFFIX = '</text></svg>';\r\n\r\nexports.name = \"makeqr\";\r\n\r\nexports.params = [\r\n\t{name: \"text\"},\r\n\t{name: \"size\"},\r\n\t{name: \"errorCorrectLevel\"},\r\n\t{name: \"fallback\"}\r\n];\r\n\r\n/*\r\nRun the macro\r\n*/\r\nexports.run = function(text,size,errorCorrectLevel,fallback) {\r\n\tvar result;\r\n\ttry {\r\n\t\tresult = generateQrCode(text,{size: size, errorCorrectLevel: errorCorrectLevel});\r\n\t} catch (ex) {\r\n\t\tconsole.log(\"makeqr error: \" + ex);\r\n\t\tresult = fallback || (\"data:image/svg+xml,\" + encodeURI(QRCODE_GENERATION_ERROR_PREFIX + ex + QRCODE_GENERATION_ERROR_SUFFIX));\r\n\t}\r\n\treturn result || \"\";\r\n};\r\n\r\nfunction generateQrCode(text,options) {\r\n\toptions = options || {};\r\n\tvar typeNumber = options.typeNumber || 4,\r\n\t\terrorCorrectLevel = options.errorCorrectLevel || \"M\",\r\n\t\tsize = options.size || 500,\r\n\t\tqr;\r\n\ttry {\r\n\t\tqr = qrcode(typeNumber,errorCorrectLevel);\r\n\t\tqr.addData(text);\r\n\t\tqr.make();\r\n\t} catch (e) {\r\n\t\tif(typeNumber >= 40) {\r\n\t\t\tthrow new Error(\"Text too long to encode\");\r\n\t\t} else {\r\n\t\t\treturn generateQrCode(text, {\r\n\t\t\t\tsize: size,\r\n\t\t\t\terrorCorrectLevel: errorCorrectLevel,\r\n\t\t\t\ttypeNumber: typeNumber + 1\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tvar cellsize = parseInt(size / qr.getModuleCount()),\r\n\t\tmargin = parseInt((size - qr.getModuleCount() * cellsize) / 2);\r\n\treturn qr.createImgTag(cellsize, margin, size);\r\n}\r\n\r\n\r\n})();\r\n","type":"application/javascript","module-type":"macro"},"$:/plugins/tiddlywiki/qrcode/MakeWifiQR":{"title":"$:/plugins/tiddlywiki/qrcode/MakeWifiQR","tags":"$:/tags/MakeQR","caption":"Wifi","text":"\\define wifi-url()\r\nWIFI:T:WPA;S:SSID;P:password;;\r\n\\end\n\n\\define image(network,encryption,ssid,password)\r\n<img src=<<makeqr text:\"\"\"WIFI:T:$encryption$;S:$ssid$;P:$password$;;\"\"\" size:\"350\">>/>\r\n\\end\n\n! Enter the details of your wifi network\n\nEncryption: <$select tiddler=\"$:/config/plugins/tiddlywiki/qrcode/wifi/encryption\" default=\"none\">\r\n<option value=\"none\">None</option>\r\n<option value=\"WEP\">WEP</option>\r\n<option value=\"WPA\">WPA</option>\r\n<option value=\"WPA2\">WPA2</option>\r\n</$select>\n\nSSID: <$edit-text tiddler=\"$:/config/plugins/tiddlywiki/qrcode/wifi/ssid\" tag=\"input\" default=\"\"/>\n\nPassword: <$edit-text tiddler=\"$:/config/plugins/tiddlywiki/qrcode/wifi/password\" tag=\"input\" default=\"\"/>\n\n! Here is your QR code\n\n<$macrocall $name=\"image\" network={{$:/config/plugins/tiddlywiki/qrcode/wifi/network}} encryption={{$:/config/plugins/tiddlywiki/qrcode/wifi/encryption}} ssid={{$:/config/plugins/tiddlywiki/qrcode/wifi/ssid}} password={{$:/config/plugins/tiddlywiki/qrcode/wifi/password}}/>\r\n"},"$:/plugins/tiddlywiki/qrcode/ViewToolbarButton":{"title":"$:/plugins/tiddlywiki/qrcode/ViewToolbarButton","tags":"$:/tags/ViewToolbar","list-before":"$:/core/ui/Buttons/close","caption":"{{$:/plugins/tiddlywiki/qrcode/icon}}","short-caption":"QR code","description":"Generate QR code for this tiddler","text":"\\whitespace trim\r\n<span class=\"tc-popup-keep\">\r\n<$button popup=<<qualify \"$:/state/popup/qrcode\">> tooltip={{$:/plugins/tiddlywiki/qrcode/ViewToolbarButton!!description}} aria-label={{$:/plugins/tiddlywiki/qrcode/ViewToolbarButton!!short-caption}} class=<<tv-config-toolbar-class>> class=<<tv-config-toolbar-class>> selectedClass=\"tc-selected\">\r\n<$list filter=\"[<tv-config-toolbar-icons>prefix[yes]]\">\r\n{{$:/plugins/tiddlywiki/qrcode/icon}}\r\n</$list>\r\n<$list filter=\"[<tv-config-toolbar-text>prefix[yes]]\">\r\n<span class=\"tc-btn-text\">\r\n<$text text=\" \"/>\r\n<$text text={{$:/plugins/tiddlywiki/qrcode/ViewToolbarButton!!short-caption}}/>\r\n</span>\r\n</$list>\r\n</$button>\r\n</span>\r\n<$reveal state=<<qualify \"$:/state/popup/qrcode\">> type=\"popup\" position=\"below\" animate=\"yes\">\n\n<div class=\"tc-drop-down\">\n\n{{$:/plugins/tiddlywiki/qrcode/ViewToolbarButton||description}}\n\n<$set name=\"tv-config-toolbar-icons\" value=\"yes\">\n\n<$set name=\"tv-config-toolbar-text\" value=\"yes\">\n\n<$set name=\"tv-config-toolbar-class\" value=\"tc-btn-invisible\">\n\n<$set name=\"targetTiddler\" value=<<currentTiddler>>>\n\n<$list filter=\"[all[shadows+tiddlers]tag[$:/tags/ViewToolbarButton/QRcode]!has[draft.of]]\">\n\n<$button popup=<<qualify \"$:/state/popup/qrcode/type\">> class=\"tc-btn-invisible\" selectedClass=\"tc-selected\">\n\n<$action-sendmessage $message=\"tm-modal\" $param=<<currentTiddler>> currentTiddler=<<targetTiddler>>/>\n\n<$transclude field=\"caption\" mode=\"inline\"/>\n\n</$button>\n\n</$list>\n\n</$set>\n\n</$set>\n\n</$set>\n\n</$set>\n\n</div>\n\n</$reveal>\r\n"},"$:/plugins/tiddlywiki/qrcode/ViewToolbarButton/Raw":{"title":"$:/plugins/tiddlywiki/qrcode/ViewToolbarButton/Raw","tags":"$:/tags/ViewToolbarButton/QRcode","caption":"Raw content of this tiddler","subtitle":"QR code of raw tiddler content","text":"\\define image()\r\n<img src=<<makeqr text:\"\"\"$(content)$\"\"\" size:\"350\">>/>\r\n\\end\n\n<$set name=\"content\" value={{!!text}}>\r\n<<image>>\r\n</$set>\r\n"},"$:/plugins/tiddlywiki/qrcode/ViewToolbarButton/Rendered":{"title":"$:/plugins/tiddlywiki/qrcode/ViewToolbarButton/Rendered","tags":"$:/tags/ViewToolbarButton/QRcode","caption":"Rendered content of this tiddler","subtitle":"QR code of rendered tiddler content","text":"\\define image()\r\n<img src=<<makeqr text:\"\"\"$(content)$\"\"\" size:\"350\">>/>\r\n\\end\n\n<$wikify name=\"content\" text={{!!text}} type=\"text\" mode=\"block\" output=\"formattedtext\">\r\n<<image>>\r\n</$wikify>\r\n"},"$:/plugins/tiddlywiki/qrcode/styles":{"title":"$:/plugins/tiddlywiki/qrcode/styles","tags":"[[$:/tags/Stylesheet]]","text":"\\rules only filteredtranscludeinline transcludeinline macrodef macrocallinline\n\n.tc-drop-down .tc-qrcode-drop-down img {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n}\r\n"},"$:/plugins/tiddlywiki/qrcode/ViewToolbarButton/URL":{"title":"$:/plugins/tiddlywiki/qrcode/ViewToolbarButton/URL","tags":"$:/tags/ViewToolbarButton/QRcode","caption":"URL of this tiddler","subtitle":"QR code of URL of this tiddler","text":"\\define image()\r\n<img src=<<makeqr text:\"\"\"$(url)$#$(hash)$\"\"\" size:\"350\">>/>\r\n\\end\n\n<$set name=\"url\" value={{$:/info/url/full}}>\r\n<$set name=\"hash\" filter=\"[<currentTiddler>encodeuricomponent[]]\" select=\"0\">\r\n<<image>>\r\n</$set>\r\n</$set>\r\n"}}}